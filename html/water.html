<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <!-- Bootstrap icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
     
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
     
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
 
    <!-- Bootstrap JS, Popper.js, and jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- link with CSS -->
    <link rel="stylesheet" href="../css/water.css">
    <link rel="stylesheet" href="../css/common.css">

    <script src="../java_script/loginsignup.js"></script>
    
    <title>Water Reminder</title>

    <style>
        #pfpImg{
          width: 60px;
          height: 75px;
        }
    </style>

</head>
<body>

    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <div class="container-xxl">
          <a href="../html/index.html" class="navbar-brand">
            <span class="fw-bold h1 fs-1 text-secondary">AjiFit</span>
          </a>
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
          data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false"
          aria-label="Toggle navigation"><span class="navbar-toggler-icon navbar-light"></span></button>
    
          <div class="d-flex flex-column" id="main-nav">
            <div class="justify-content-start  align-items-center pt-4">
              <span class="fs-5 text-warning">Where Flavor Meets Fitness, Naturally.</span>
            </div>
            <div class="collapse navbar-collapse justify-content- align-items-center ms-1" id="main-nav">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a href="../html/index.html" class="nav-link text-dark">Home</a>
                </li>
                <li class="nav-item">
                  <a href="../html/menu.html" class="nav-link text-dark">Receipe</a>
                </li>
                <li class="nav-item">
                  <a href="../html/exercise.html" class="nav-link text-dark">Exercise</a>
                </li>
                <li class="nav-item">
                  <a href="../html/Tracker.html" class="nav-link text-dark">Calories Tracker</a>
                </li>
                <li class="nav-item">
                  <a href="../html/water.html" class="nav-link text-dark">Water Reminder</a>
                </li>
                <li class="nav-item">
                  <a href="../html/ck.html" class="nav-link text-dark">Community</a>
                </li>
                <li class="nav-item">
                  <a href="../html/faqs.html" class="nav-link text-dark">FAQS</a>
                </li>
                <li class="logged-in nav-item">
                  <a href="./login.html" class="nav-link text-dark" id="logout">Logout</a>
                </li>
              </ul>
            </div>
          </div>
          
          <div class="collapse navbar-collapse justify-content-end align-items-center" id="main-nav">
            <li class="nav-item ms-2 d-none d-md-inline mt-0 pt-0">
              <div>
                <span class="fs-5 text-warning mt-3" id="name1">User_name</span>
                <a href="../html/profile.html"><img src="..." id="pfpImg" class="rounded-circle fs-1 border border-1" alt="..."></a>
              </div>
            </li>
          </div>
        </div>
      </nav>

    <!-- water reminder -->
    <div class="container-fluid my-5" id="water-reminder">
        <div class="row">

            <!-- left side -->
            <div class="col-6">

                <!-- upper part -->
                <div class="row">

                    <!-- title -->
                    <div class="col-8">
                        <h5 class="fs-1 fw-bold">
                            Water Reminder
                        </h5>                        
                    </div>

                    <!-- icon - more infor -->
                    <div class="col-4">

                        <button type="button" class="btn" data-toggle="tooltip" data-placement="top" title="Click on the open button to get water reminder from this website!">
                            <i class="bi bi-info-circle-fill fs-2"></i>
                        </button>
                        
                    </div>

                </div>

                <p class="lead text-muted">Click on the open button to enjoy water reminder function!</p>

                <div class="row text-center justify-content-start">
                    <!-- open btn -->
                    <div class="col-6">
                        <div class="water-btn">
                            <button id="openReminder" class="btn">
                                <h3 class="fw-normal">OPEN</h3>
                            </button>
                        </div>
                    </div>

                    <!-- close btn -->
                    <div class="col-6">
                        <div class="water-btn">
                            <button id="closeReminder" class="btn" disabled>
                                <h3 class="fw-normal">CLOSE</h3>
                            </button>
                        </div>
                    </div>
                </div>


                <!-- lower part -->
                <div class="row mt-4 px-3 py-3" id="water-calc">
                    <div class="col-6">
                        <form>
                            <div class="mb-3">
                                <label for="bodyWeightInput" class="form-label"><h3 class="fw-normal">Enter your body weight:</h3></label>
                                <div class="mb-4 input-group">
                                    <input type="text" maxlength="3" class="form-control" id="bodyWeightInput">
                                    <span class="input-group-text">
                                        kg
                                    </span>
                                </div>
                            </div>
                        </form>
                        <button type="submit" id="clacWaterBtn" class="btn text-center fs-4 mt-4">Calculate Now</button>
                    </div>

                    <div class="col-6 text-center">
                        <h3 class="fw-normal">Water Needed: </h3>

                        <!-- water-circle -->
                        <div class="px-3 py-2">
                            <div id="water-circle">
                                <h6 class="lead"><span id="waterNeededResult" class="fs-2"></span> ml</h6>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
    
            <!-- right side -->
            <div class="col-6 text-center mt-5" id="water-reminder-right">

                <div id="waterBottleOuter" class="container-sm mb-4">

                    <div id="waterBottleInner"></div>

                </div>

                <h4 class="fw-normal mt-3">YOU HAD DRINK: <span id="waterDrinkDisplay" style="font-weight:bold; color: #192939;">0 ml</span></h4>
            </div>

        </div>
    </div>

    <!-- water information -->
    <div class="container-fluid mb-5">
        <h5 class="fs-1 fw-bold text-center">
            Water Blog 
        </h5>
        <p class="lead text-center">Come and explore more about "water".</p>

        <!-- text -->
        <div class="accordion container-lg" id="water-text">
            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                        What is water
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
                <div class="accordion-body">
                    <p class="lead">
                        Water, a substance composed of the chemical elements hydrogen and oxygen and existing in gaseous, liquid, and solid states. It is one of the most plentiful and essential of compounds. A tasteless and odourless liquid at room temperature, it has the important ability to dissolve many other substances. Indeed, the versatility of water as a solvent is essential to living organisms. Life is believed to have originated in the aqueous solutions of the world’s oceans, and living organisms depend on aqueous solutions, such as blood and digestive juices, for biological processes. Water also exists on other planets and moons both within and beyond the solar system. In small quantities water appears colourless, but water actually has an intrinsic blue colour caused by slight absorption of light at red wavelengths.
                    </p>
                </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                    Benefit of drinking water
                </button>
                </h2>
                <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
                <div class="accordion-body">
                    <p class="lead">
                        Getting enough water every day is important for your health. Drinking water can prevent dehydration, a condition that can cause unclear thinking, result in mood change, cause your body to overheat, and lead to constipation and kidney stones. Water has no calories, so it can also help with managing body weight and reducing calorie intake when substituted for drinks with calories, such as sweet tea or regular soda.
                    </p>

                    <br>

                    <p class="lead fw-bold">Water helps body to : </p>
                    <ul>
                        <li>Keep a normal temperature.</li>
                        <li>Lubricate and cushion joints.</li>
                        <li>Protect your spinal cord and other sensitive tissues.</li>
                        <li>Get rid of wastes through urination, perspiration, and bowel movements.</li>
                    </ul>

                    <br>

                    <p class="lead fw-bold">Water is important especially people are: </p>
                    <ul>
                        <li>In hot climates.</li>
                        <li>More physically active.</li>
                        <li>Running a fever.</li>
                        <li>Having diarrhea or vomiting.</li>
                    </ul>
                </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
                    How much water do we need? 
                </button>
                </h2>
                <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingThree">
                <div class="accordion-body">
                    <p class="lead">
                        Every day you lose water through your breath, perspiration, urine and bowel movements. For your body to function properly, you must replenish its water supply by consuming beverages and foods that contain water.
                    </p>

                    <p class="lead">
                        So how much fluid does the average, healthy adult living in a temperate climate need? The U.S. National Academies of Sciences, Engineering, and Medicine determined that an adequate daily fluid intake is:
                    </p>

                    <br>

                    <ul>
                        <li>About 15.5 cups (3.7 liters) of fluids a day for men</li>
                        <li>About 11.5 cups (2.7 liters) of fluids a day for women</li>
                    </ul>

                    <br>

                    <p class="lead">
                        These recommendations cover fluids from water, other beverages and food. About 20% of daily fluid intake usually comes from food and the rest from drinks.
                    </p>
                </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- footer -->
    <footer>
        <div class="container-fluid justify-content-center text-center py-5">
            <div class="row footer-padding">
                <!-- All link -->
                <div class="col-sm-1 col-md-4 col-lg-4">
                    <div id="footer-link">
                        <ul>
                            <li>
                                <h4><a href="../html/index.html">Home</a></h4>
                            </li>
                            <li>
                                <h4><a href="../html/menu.html">Receipe</a></h4>
                            </li>
                            <li>
                                <h4><a href="../html/exercise.html">Exercise</a></h4>
                            </li>
                            <li>
                                <h4><a href="../html/Tracker.html">Calories Tracker</a></h4>
                            </li>
                        </ul>
                    </div>
                </div>
  
                <div class="col-sm-1 col-md-4 col-lg-3">
                    <div id="footer-link">
                        <ul>
                            <li>
                                <h4><a href="../html/water.html">Water Reminder</a></h4>
                            </li>
                            <li>
                                <h4><a href="../html/ck.html">Community</a></h4>
                            </li>
                            <li>
                                <h4><a href="../html/faqs.html">FAQS</a></h4>
                            </li>
                        </ul>
                    </div>
                </div>
  
                <!-- Contact -->
                <div class="col-sm-2 col-md-4 col-lg-5">
                    <h3 class="fs-2 fw-bold">Contact Us</h3>
                    
                    <div class="contact-icon">
                        <a href="https://www.instagram.com/accounts/login"><i class="bi bi-instagram fs-1 me-3"></i></a>
                        <a href="https://web.facebook.com"><i class="bi bi-facebook fs-1 me-3"></i></a>
                        <a href="https://twitter.com/i/flow/login"><i class="bi bi-twitter fs-1 me-3"></i></a>
                    </div>
                    
                    <div class="star mt-3 mb-1">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill fs-3"></i>
                        <i class="bi bi-star-fill"></i>
                    </div>
  
                    <p>&copy; 2004 - 2024 AjiFit. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase.js"></script>

    <script>
        
        // Initialize Bootstrap tooltips
        $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip();
        });

        document.addEventListener('DOMContentLoaded', function() {

            //----- FIREBASE -----
            // Initialize Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyBROf8x8AaOQmWY5z1vb0icjOkWoDha6zo",
                authDomain: "useruser-5f5dc.firebaseapp.com",
                databaseURL: "https://useruser-5f5dc-default-rtdb.firebaseio.com",
                projectId: "useruser-5f5dc",
                storageBucket: "useruser-5f5dc.appspot.com",
                messagingSenderId: "294580009654",
                appId: "1:294580009654:web:a0ca0ae3dbaedd53704417",
                measurementId: "G-BZTH9RR80E"
            };

            firebase.initializeApp(firebaseConfig);

            const db = firebase.database();

            //connect to local storage
            const userID = localStorage.getItem('userId');
            const userEmail = localStorage.getItem('userEmail');

            // open and close reminder
            const openR = document.getElementById('openReminder');
            const closeR = document.getElementById('closeReminder');

            const weightDisplay = document.getElementById('bodyWeightInput');
            const waterNeedDisplay = document.getElementById('waterNeededResult');

            db.ref(userID).on('value', function(snapshot){
                var data = snapshot.val();

                const name1 = data.name;
                const pfpImg = data.profileImg;

                setPfInfo(name1, pfpImg);


                var weight = data.weight

                weightDisplay.value = weight;
                calcWater(weight);

                if (!(data.water === 0)){
                    var drinkValue = data.water;

                    openR.disabled = true;
                    closeR.disabled = false;

                    console.log("Drink value:", drinkValue);
                    
                    updateWaterLevel(drinkValue);
                    waterDrinkDisplay.textContent = ( drinkValue + " ml");
                }else {
                    waterDrinkDisplay.textContent = ( "0 ml");
                }
            });

            function setPfInfo(name, pfpImg) {
                document.getElementById('name1').textContent = name;
                document.getElementById('pfpImg').src = pfpImg;
            }

            function calcWater(w) {
                var water_need = parseInt(w * 30);
                //console.log(water_need);
                waterNeedDisplay.textContent = water_need;
            }

            const waterDrinkDisplay = document.getElementById('waterDrinkDisplay');

            // update water level
            function updateWaterLevel(waterDrink) {
                const waterBottleInner = document.getElementById('waterBottleInner');
                const percentageFilled = (waterDrink / parseInt(waterNeedDisplay.textContent)) * 100;
                console.log('water drink:',waterDrink);
                console.log('water need:',parseInt(waterNeedDisplay.textContent));
                waterBottleInner.style.height = percentageFilled + '%';
            }

            openR.addEventListener('click', function() {

                let waterDrink = 0;
                if(confirm("You will get your reminder every 1 hour! Thanks for opening our water reminder!")){
                    openR.disabled = true;
                    closeR.disabled = false;

                    updateWaterLevel(waterDrink);

                } else {
                    openR.disabled = true;
                    closeR.disabled = false;
                }

                sendEmailReminder();

                setInterval(function() {
                    sendEmailReminder();

                }, 1000 * 60 * 60); // 1000ms * 60s * 60min = 1hr

            });

            function sendEmailReminder() {
                console.log("Time to drink water! Don't forget to hydrate.");

                if(confirm("Time to drink water! Don't forget to hydrate.")){
                    waterDrink += 100;

                    updateWaterLevel(waterDrink);
                
                    db.ref(userID).update({
                        water: waterDrink
                    });

                }

                console.log(waterDrink);

                waterDrinkDisplay.textContent = ( waterDrink + " ml");
            }

            closeR.addEventListener('click', function() {
                console.log("Water Reminder: Close");
                if (confirm("Why are you deny me >< ")) {
                    openR.disabled = false;
                    closeR.disabled = true;
                } else {
                    openR.disabled = false;
                    closeR.disabled = true;
                }

                waterDrink = 0;
                updateWaterLevel(waterDrink);
                waterDrinkDisplay.textContent = ( waterDrink + " ml");

                // update in firebase
                db.ref(userID).update({
                    water: 0
                });
            });

            // ----- BREAK LINE ------
            // weight input
            weightDisplay.addEventListener('input', function () {
                const value = weightDisplay.value.trim();
                if (value.trim() === '') {
                    return true; // Allow empty value
                }

                if (!/^\d+$/.test(value)) {
                    weightDisplay.value = "";
                    alert("Invalid value. Please enter digit only.");
                    return false;
                }
            });

            const calcBtn = document.getElementById('clacWaterBtn');
            calcBtn.addEventListener('click', function() {

                var value = weightDisplay.value.trim();
                if (value === "") {
                    weightDisplay.value = "";
                    alert("Please enter your weight.");
                    return false;
                } else if (value.length === 1) {
                    weightDisplay.value = "";
                    alert ("OH NO! YOU ARE TOO SKINNY! EAT MORE! Please enter valid weight.")
                    return false;
                } else {
                    calcWater(value);

                    var waterNeedText = waterDrinkDisplay.textContent;
                    var waterNeed = parseInt(waterNeedText.substring(0, waterNeedText.indexOf(' ml')));
                    
                    updateWaterLevel(waterNeed);
                    console.log('waterNeed:', waterNeed);
                }
            });

        });
        
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>